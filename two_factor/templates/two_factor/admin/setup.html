{% extends "admin/login.html" %}

{% load i18n admin_static two_factor %}

{% block extrastyle %}{{ block.super }}{% include "two_factor/admin/_style.html" %}{% endblock %}

{% block content %}
{% if form.errors and not form.non_field_errors and not form.this_is_the_login_form.errors %}
<p class="errornote">
{% if form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
</p>
{% endif %}

{% if form.non_field_errors or form.this_is_the_login_form.errors %}
{% for error in form.non_field_errors|add:form.this_is_the_login_form.errors %}
<p class="errornote">
    {{ error }}
</p>
{% endfor %}
{% endif %}

<div id="content-main">
<form action="{{ app_path }}" method="post" id="login-form">{% csrf_token %}
  <div class="form-row">
  {% if wizard.steps.current == 'welcome' %}
    {% blocktrans %}You are about to take your account security to the next level. Follow the steps in this wizard to enable two-factor authentication.{% endblocktrans %}
  {% elif wizard.steps.current == 'method' %}
    {% blocktrans %}Please select which authentication method you would like to use.{% endblocktrans %}
  {% elif wizard.steps.current == 'generator' %}
    {% blocktrans %}To start using a token generator, please use your smartphone to scan the QR code below. For example, use Google Authenticator. Then, enter the token generated by the app. {% endblocktrans %}
    <img src="{{ QR_URL }}" alt="QR Code" />
  {% elif wizard.steps.current == 'sms' %}
    {% blocktrans %}Please enter the phone number you wish to receive the text messages on. This number will be validated in the next step. {% endblocktrans %}
  {% elif wizard.steps.current == 'call' %}
    {% blocktrans %}Please enter the phone number you wish to be called on. This number will be validated in the next step. {% endblocktrans %}
  {% elif wizard.steps.current == 'validation' %}
    {% if challenge_succeeded %}
      {% if device.method == 'call' %}
        {% blocktrans %}We are calling your phone right now, please enter the digits you hear.{% endblocktrans %}
      {% elif device.method == 'sms' %}
        {% blocktrans %}We sent you a text message, please enter the tokens we sent.{% endblocktrans %}
      {% endif %}
    {% else %}
      <p class="alert alert-warning" role="alert">{% blocktrans %}We've encountered an issue with the selected authentication method. Please go back and verify that you entered your information correctly, try again, or use a different authentication method instead. If the issue persists, contact the site administrator.{% endblocktrans %}
    {% endif %}
  {% elif wizard.steps.current == 'yubikey' %}
    {% blocktrans %}To identify and verify your YubiKey, please insert a token in the field below. Your YubiKey will be linked to your account.{% endblocktrans %}
  {% endif %}
  </div>

  {% include "two_factor/_wizard_forms.html" %}

  {% include "two_factor/admin/_wizard_actions.html" %}

</form>

</div>
{% endblock %}
